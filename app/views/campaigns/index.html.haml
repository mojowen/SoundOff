%h1 My Campaigns

#content.index
	%p Below is the URL for your campaign(s). Send it to your supporters and invite them to SoundOff!
	%p You also can place a widget for your campaign on any web page (see link below), and download data on your users.

	.dumb_table
		%table
			%thead
				%tr
					%th.name Campaign Name
					%th.url URL
					%th.pending Status
					%th{ :colspan => current_user.admin || current_user.partner.partner_type == 'nonprofit' ? 3 : 2 } Menu
			%tbody
				- @campaigns.each do |campaign|

					%tr
						%td.name= campaign.name
						%td.url= link_to campaign.url, campaign.url
						%td.pending= render 'status', :campaign => campaign
						%td.dl= link_to 'Create Widgets', campaign_path( campaign )
						- if current_user.admin || current_user.partner.partner_type == 'nonprofit'
							%td.dl= link_to 'Download User Data', campaign_path( campaign )+'.text'
						%td.dl= link_to 'Edit Campaign', edit_campaign_path( campaign )

	%a{ :href => new_campaign_path }
		%button Launch New Campaign
	&nbsp;
	- if current_user.admin
		%a{ :href => all_path+'.text' }
			%button All HeadCount Singups

:javascript
	$(document).on('change','.change_status',function() {
		var $this = $(this),
			status = $this.val().toLowerCase(),
			campaign = $this.attr('campaign')

		if( status == 'destroy' && ! confirm('Are you sure you want to delete this campaign?') ) return false;

		$.ajax({
			url: '/campaigns/'+campaign+'.json',
			data: { status: status},
			type: status == 'destroy' ? 'DELETE' : 'PUT',
			dataType: 'JSON',
			success: function() { if( status == 'destroy') $this.parents('tr').remove(); }
		})
	})